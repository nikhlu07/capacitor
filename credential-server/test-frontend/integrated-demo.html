<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travlr-ID + Veridian Integration Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        
        .status-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Monaco', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .aid-display {
            font-family: monospace;
            background: #f1f3f4;
            padding: 8px;
            border-radius: 4px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé´ Travlr-ID + Veridian Integration</h1>
        <p class="subtitle">Real ACDC Credentials using your existing AID system + Veridian's pattern</p>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>üè• Server Health</h3>
                <div id="serverStatus">Checking...</div>
                <button onclick="checkHealth()">Check Now</button>
            </div>
            
            <div class="status-card">
                <h3>üìã Schema Status</h3>
                <div id="schemaStatus">Checking...</div>
                <button onclick="checkSchema()">Verify Schema</button>
            </div>
        </div>
        
        <div class="form-section">
            <h2>üë§ Employee Identity (Your AID System)</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="displayName">Display Name:</label>
                    <input type="text" id="displayName" value="John Doe" placeholder="Employee Name">
                </div>
                
                <div class="form-group">
                    <label for="employeeId">Employee ID:</label>
                    <input type="text" id="employeeId" value="EMP001" placeholder="EMP001">
                </div>
            </div>
            
            <div class="form-group">
                <label for="aid">Employee AID:</label>
                <input type="text" id="aid" 
                       value="EKS5pEzx-bEsKUJJhYKkbxtaAJwBJJHb68Mj8d_z6E0" 
                       placeholder="Your real AID from frontend">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Use a real AID from your frontend identity system
                </small>
            </div>
        </div>
        
        <div class="form-section">
            <h2>‚úàÔ∏è Travel Preferences (Credential Data)</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="seatPreference">Seat Preference:</label>
                    <select id="seatPreference">
                        <option value="window">Window</option>
                        <option value="aisle">Aisle</option>
                        <option value="middle">Middle</option>
                        <option value="any">Any</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="mealPreference">Meal Preference:</label>
                    <select id="mealPreference">
                        <option value="vegetarian">Vegetarian</option>
                        <option value="standard">Standard</option>
                        <option value="vegan">Vegan</option>
                        <option value="kosher">Kosher</option>
                        <option value="halal">Halal</option>
                        <option value="gluten-free">Gluten-free</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="airlines">Preferred Airlines:</label>
                    <input type="text" id="airlines" value="Delta, United" placeholder="Preferred airlines">
                </div>
                
                <div class="form-group">
                    <label for="emergencyContact">Emergency Contact:</label>
                    <input type="text" id="emergencyContact" value="Jane Doe: +1-555-123-4567" placeholder="Contact info">
                </div>
            </div>
            
            <div class="form-group">
                <label for="allergies">Allergies/Restrictions:</label>
                <textarea id="allergies" rows="2" placeholder="Food allergies, mobility assistance, etc.">Peanut allergy</textarea>
            </div>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="testIntegration()" style="background: linear-gradient(45deg, #2ecc71, #27ae60);">
                üß™ Test Frontend Integration
            </button>
            
            <button onclick="issueCredential()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                üé´ Issue Travel Credential
            </button>
            
            <button onclick="getSchemaInfo()">
                üìã Get Schema Info
            </button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        const serverUrl = 'http://localhost:3001';
        const schemaId = 'Etk6EhuG09iXynnvGIxUZxYwugDCNC9G80ouiJ1apMlU';

        // Helper function to display results
        function showResult(id, content, type = 'info') {
            const container = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${id}:</strong>\n${typeof content === 'object' ? JSON.stringify(content, null, 2) : content}`;
            container.innerHTML = '';
            container.appendChild(resultDiv);
        }

        // Get form data
        function getIdentity() {
            return {
                aid: document.getElementById('aid').value.trim(),
                displayName: document.getElementById('displayName').value.trim(),
                employeeId: document.getElementById('employeeId').value.trim(),
                created: new Date().toISOString()
            };
        }

        function getPreferences() {
            return {
                employeeId: document.getElementById('employeeId').value.trim(),
                seatPreference: document.getElementById('seatPreference').value,
                mealPreference: document.getElementById('mealPreference').value,
                airlines: document.getElementById('airlines').value.trim(),
                emergencyContact: document.getElementById('emergencyContact').value.trim(),
                allergies: document.getElementById('allergies').value.trim()
            };
        }

        // Check server health
        async function checkHealth() {
            try {
                const response = await fetch(`${serverUrl}/ping`);
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('serverStatus').innerHTML = 
                        `‚úÖ Online<br><small>${result.message}</small>`;
                    showResult('Server Health Check', result, 'success');
                } else {
                    document.getElementById('serverStatus').innerHTML = '‚ùå Error';
                    showResult('Server Health Check', result, 'error');
                }
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = '‚ùå Offline';
                showResult('Server Health Check', `Error: ${error.message}`, 'error');
            }
        }

        // Check schema availability
        async function checkSchema() {
            try {
                const response = await fetch(`${serverUrl}/oobi/${schemaId}`);
                if (response.ok) {
                    const schema = await response.json();
                    document.getElementById('schemaStatus').innerHTML = 
                        `‚úÖ Available<br><small>${schema.title}</small>`;
                    showResult('Schema Check', { 
                        status: '‚úÖ Schema available via OOBI',
                        title: schema.title,
                        url: `${serverUrl}/oobi/${schemaId}`
                    }, 'success');
                } else {
                    document.getElementById('schemaStatus').innerHTML = '‚ùå Not found';
                    showResult('Schema Check', 'Schema not available', 'error');
                }
            } catch (error) {
                document.getElementById('schemaStatus').innerHTML = '‚ùå Error';
                showResult('Schema Check', `Error: ${error.message}`, 'error');
            }
        }

        // Test frontend integration
        async function testIntegration() {
            const identity = getIdentity();
            const preferences = getPreferences();

            if (!identity.aid) {
                showResult('Integration Test', 'Please enter an AID', 'error');
                return;
            }

            try {
                const response = await fetch(`${serverUrl}/test-with-frontend-aid`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identity, preferences })
                });

                const result = await response.json();
                showResult('Frontend Integration Test', result, result.success ? 'success' : 'error');

            } catch (error) {
                showResult('Integration Test', `Error: ${error.message}`, 'error');
            }
        }

        // Issue travel credential
        async function issueCredential() {
            const identity = getIdentity();
            const preferences = getPreferences();

            if (!identity.aid) {
                showResult('Credential Issuance', 'Please enter an AID', 'error');
                return;
            }

            try {
                const response = await fetch(`${serverUrl}/credentials/issue`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        holderAid: identity.aid,
                        travelPreferences: preferences
                    })
                });

                const result = await response.json();
                showResult('Travel Credential Issuance', result, result.success ? 'success' : 'error');

            } catch (error) {
                showResult('Credential Issuance', `Error: ${error.message}`, 'error');
            }
        }

        // Get schema information
        async function getSchemaInfo() {
            try {
                const response = await fetch(`${serverUrl}/schemas`);
                const result = await response.json();
                showResult('Schema Information', result, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('Schema Info', `Error: ${error.message}`, 'error');
            }
        }

        // Auto-check on page load
        window.addEventListener('load', () => {
            checkHealth();
            checkSchema();
        });
    </script>
</body>
</html>