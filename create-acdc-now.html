<!DOCTYPE html>
<html>
<head>
    <title>Create ACDC Credential Now</title>
</head>
<body>
    <h1>Creating ACDC Credential...</h1>
    <div id="status">Starting...</div>
    <pre id="log"></pre>

    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message) {
            log.textContent += message + '\n';
            console.log(message);
        }

        async function createACDCNow() {
            try {
                status.textContent = "ðŸŽ« Creating ACDC credential...";
                addLog('ðŸŽ« Starting ACDC credential creation...');

                // Import your services (assuming they're available globally)
                const { TravlrIdentityService } = await import('http://localhost:3009/static/js/bundle.js');
                const { TravlrACDCService } = await import('http://localhost:3009/static/js/bundle.js');

                addLog('ðŸ“¦ Services imported successfully');

                // Initialize identity service
                await TravlrIdentityService.initialize();
                addLog('âœ… TravlrIdentityService initialized');

                // Get or create identity
                let identity = await TravlrIdentityService.getCurrentIdentityAsync();
                if (!identity) {
                    addLog('ðŸ”„ No identity found, creating one...');
                    identity = await TravlrIdentityService.createEmployeeIdentity('ACDC-TEST-001', 'ACDC Test User');
                    addLog('âœ… Test identity created');
                } else {
                    addLog('âœ… Found existing identity: ' + identity.aid);
                }

                // Create ACDC credential
                const preferences = {
                    employeeId: 'ACDC-TEST-001',
                    seatPreference: 'window',
                    mealPreference: 'vegetarian',
                    airlines: 'Test Airways',
                    emergencyContact: 'Test Contact',
                    allergies: 'None'
                };

                addLog('ðŸŽ« Creating ACDC credential...');
                addLog('ðŸ‘¤ Using AID: ' + identity.aid);

                const result = await TravlrACDCService.createTravelPreferencesCredential(
                    identity.aid, // issuer
                    identity.aid, // holder (same for self-issued)
                    preferences
                );

                if (result.success) {
                    status.textContent = "ðŸŽ‰ SUCCESS!";
                    addLog('ðŸŽ‰ ACDC CREDENTIAL CREATED SUCCESSFULLY!');
                    addLog('ðŸ†” Credential ID: ' + result.data.credentialId);
                    addLog('ðŸ“‹ Schema SAID: ' + result.data.schemaSaid);
                    addLog('ðŸ‘¤ Recipient: ' + result.data.recipient);
                    addLog('âœ… Credential stored in KERIA LMDB database!');
                } else {
                    throw new Error('Credential creation failed: ' + JSON.stringify(result));
                }

            } catch (error) {
                status.textContent = "âŒ ERROR";
                addLog('âŒ Error: ' + error.message);
                addLog('Stack: ' + error.stack);
            }
        }

        // Start immediately when page loads
        window.onload = () => {
            setTimeout(createACDCNow, 1000);
        };
    </script>
</body>
</html>